generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         String          @id @default(uuid()) @db.Uuid
  email                      String          @unique @db.VarChar(255)
  passwordHash               String          @map("password_hash") @db.VarChar(255)
  role                       enum_users_role @default(student)
  fullName                   String?         @map("full_name") @db.VarChar(255)
  phone                      String?         @db.VarChar(255)
  profilePictureUrl          String?         @map("profile_picture_url") @db.VarChar(255)
  isVerified                 Boolean?        @default(false) @map("is_verified")
  verification_token         String?         @db.VarChar(255)
  verification_token_expires DateTime?       @db.Timestamptz(6)
  reset_password_token       String?         @db.VarChar(255)
  reset_password_expires     DateTime?       @db.Timestamptz(6)
  refresh_token              String?
  createdAt                  DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                  DateTime        @updatedAt @map("updated_at") @db.Timestamptz(6)
  admins                     admins?
  faculty                    Faculty?
  student                    Student?
  emailVerificationToken     EmailVerificationToken?
  passwordResetTokens        PasswordResetToken[]
  refreshTokens              RefreshToken[]

  @@map("users")
}

model Faculty {
  id             String     @id @default(uuid()) @db.Uuid
  userId         String     @unique @map("user_id") @db.Uuid
  employeeNumber String     @unique @map("employee_number") @db.VarChar(255)
  title          String     @db.VarChar(255)
  departmentId   String     @map("department_id") @db.Uuid
  created_at     DateTime   @default(now()) @db.Timestamptz(6)
  updated_at     DateTime   @updatedAt @db.Timestamptz(6)
  department     Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  user           User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("faculty")
}

model Student {
  id            String     @id @default(uuid()) @db.Uuid
  userId        String     @unique @map("user_id") @db.Uuid
  studentNumber String     @unique @map("student_number") @db.VarChar(255)
  departmentId  String     @map("department_id") @db.Uuid
  gpa           Decimal?   @default(0.0) @db.Decimal(3, 2)
  cgpa          Decimal?   @default(0.0) @db.Decimal(3, 2)
  created_at    DateTime   @default(now()) @db.Timestamptz(6)
  updated_at    DateTime   @updatedAt @db.Timestamptz(6)
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  department    Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@map("students")
}

model EmailVerificationToken {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @unique @map("user_id") @db.Uuid
  token     String   @unique @db.VarChar(255)
  expiresAt DateTime @map("expires_at") @db.Timestamptz(6)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("email_verification_tokens")
}

model PasswordResetToken {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  token     String   @unique @db.VarChar(255)
  expiresAt DateTime @map("expires_at") @db.Timestamptz(6)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("password_reset_tokens")
}

model RefreshToken {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  token     String   @unique @db.VarChar(255)
  expiresAt DateTime @map("expires_at") @db.Timestamptz(6)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model Department {
  id         String    @id @default(uuid()) @db.Uuid
  name       String    @db.VarChar(255)
  code       String    @unique @db.VarChar(255)
  facultyName String   @map("faculty") @db.VarChar(255)
  createdAt  DateTime  @map("created_at") @db.Timestamptz(6)
  updated_at DateTime  @db.Timestamptz(6)
  courses    courses[]
  faculty    Faculty[]
  students   Student[]

  @@map("departments")
}

model SequelizeMeta {
  name String @id @db.VarChar(255)
}

model admins {
  id              String    @id @db.Uuid
  user_id         String    @unique @db.Uuid
  employee_number String    @unique @db.VarChar(255)
  permissions     Json?     @default("{}")
  deleted_at      DateTime? @db.Timestamptz(6)
  created_at      DateTime  @db.Timestamptz(6)
  updated_at      DateTime  @db.Timestamptz(6)
  users           User      @relation(fields: [user_id], references: [id], onDelete: NoAction)
}

model courses {
  id            String                @id @db.Uuid
  code          String                @unique @db.VarChar(20)
  name          String                @db.VarChar(255)
  description   String?
  credits       Int
  department_id String                @db.Uuid
  semester      enum_courses_semester
  year          Int
  is_active     Boolean?              @default(true)
  metadata      Json?                 @default("{}")
  deleted_at    DateTime?             @db.Timestamptz(6)
  created_at    DateTime              @db.Timestamptz(6)
  updated_at    DateTime              @db.Timestamptz(6)
  departments   Department            @relation(fields: [department_id], references: [id], onDelete: NoAction)

  @@index([code], map: "courses_code")
  @@index([department_id], map: "courses_department_id")
  @@index([semester, year], map: "courses_semester_year")
}

enum enum_courses_semester {
  fall
  spring
  summer
}

enum enum_users_role {
  student
  faculty
  admin
}
